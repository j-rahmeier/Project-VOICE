<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8"/>
<title>Technical Reference:States of Operation - BCI2000 Help</title>
<link rel='shortcut icon' href='../../rsrc/favicon.ico' />
<style type='text/css'>
html { font-size:95%; font-family:arial,helvetica,sans-serif }
.printfooter { display:none }
#tocmain { font-size:81%; font-weight:bold; color:black; background-color:white; border:1px solid black; padding:1em; z-index:10; position:fixed; left:-1px; top:-1px; width:150px; }
#tocmain a { color:blue; text-decoration:none }
#tocmain ul { margin:0 0 0 0.4em; padding:0.1em 0 0 0.1em; list-style-position:outside; list-style-type:disc }
#tocmain li { text-indent:0; margin:0 0 0 1em; padding: 0 0 0 0 }
#tocmain p { margin:0; padding:0.1em 0 0 0.1em }
#tocmain .toc1 { margin-left:1.25em; }
#tocmain .toc2 { margin-left:2.25em; }
#tocmain .toc3 { margin-left:3.25em; }
#article { font-size:91%; position:absolute; left:200px; right:0; padding:1em; margin:0 }
</style>
</head>
<body>
 <div id='tocmain'>
 <a href='Main_Page.html'><img src='../../rsrc/bci2000logo.svg' alt='[Main Page]' /></a> <hr class="sep" /><p class="toc0"><a href="User_Tutorial%253ABCI2000_Tour.html">GettingStarted</a></p><ul></ul><p class="toc0"><a href="User_Reference%253AContents.html">User Manual</a></p><ul></ul><p class="toc0"><a href="Technical_Reference%253AContents.html">Technical Reference</a></p><ul><li class="toc1">System Design and Communication Protocols</li><ul><li class="toc2"><a href="Technical_Reference%253ASystem_Design.html">System Design</a></li><li class="toc2"><a href="Technical_Reference%253ACore_Modules.html">Core Modules</a></li><li class="toc2">States of Operation</li></ul><li class="toc1">Transmission Protocol Specification</li><ul><li class="toc2"><a href="Technical_Reference%253ABCI2000_Messages.html">BCI2000 Messages</a></li><li class="toc2"><a href="Technical_Reference%253AParameter_Definition.html">Parameter Definition</a></li><li class="toc2"><a href="Technical_Reference%253AState_Definition.html">State Definition</a></li><li class="toc2"><a href="Technical_Reference%253AVisualization_Properties.html">Visualization Properties</a></li></ul><li class="toc1">File Formats</li><ul><li class="toc2"><a href="Technical_Reference%253ABCI2000_File_Format.html">Data File Format</a></li><li class="toc2"><a href="Technical_Reference%253AParameter_File.html">Parameter File Format</a></li></ul><li class="toc1">External Interfaces</li><ul><li class="toc2"><a href="Technical_Reference%253AApp_Connector.html">App Connector</a></li><li class="toc2"><a href="Technical_Reference%253AOperator_Library.html">Operator Library</a></li><li class="toc2"><a href="Technical_Reference%253ABCI2000Remote_Library.html">BCI2000Remote</a></li></ul></ul><p class="toc0"><a href="Programming_Reference%253AContents.html">Programming Manual</a></p><ul></ul><p class="toc0"><a href="Contributions%253AContents.html">Contributions</a></p><ul></ul><hr class="sep" /><p class="toc0"><a href="BCI2000_Glossary.html">BCI2000 Glossary</a></p> </div>
 <div id='article'>
 <h1 class = "pagetitle">States of Operation</h1>
 <p class = "subtitle">Technical Reference</p>
 <hr class = "sep" />
 <div id="mw-content-text" lang="en" dir="ltr" class="mw-content-ltr"><div class="mw-parser-output"><p>This page describes the states of operation that apply to a BCI2000 system as a whole.
These are different from the concept of <a href="BCI2000_Glossary.html#State" title="BCI2000 Glossary">BCI2000 state variables</a> which are saved to data files.
</p><p>Driven by user interaction from the operator module, the system cycles through five phases of operation:
Startup, Initialization, Suspended, Running, Termination.
</p>
<div id="toc" class="toc" role="navigation" aria-labelledby="mw-toc-heading"><input type="checkbox" role="button" id="toctogglecheckbox" class="toctogglecheckbox" style="display:none" /><div class="toctitle" lang="en" dir="ltr"><h2 id="mw-toc-heading">Contents</h2><span class="toctogglespan"><label class="toctogglelabel" for="toctogglecheckbox"></label></span></div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="Technical_Reference%253AStates_of_Operation.html#State_Diagram"><span class="tocnumber">1</span> <span class="toctext">State Diagram</span></a></li>
<li class="toclevel-1 tocsection-2"><a href="Technical_Reference%253AStates_of_Operation.html#System_Startup"><span class="tocnumber">2</span> <span class="toctext">System Startup</span></a>
<ul>
<li class="toclevel-2 tocsection-3"><a href="Technical_Reference%253AStates_of_Operation.html#Introduction"><span class="tocnumber">2.1</span> <span class="toctext">Introduction</span></a></li>
<li class="toclevel-2 tocsection-4"><a href="Technical_Reference%253AStates_of_Operation.html#Startup_Sequence"><span class="tocnumber">2.2</span> <span class="toctext">Startup Sequence</span></a></li>
<li class="toclevel-2 tocsection-5"><a href="Technical_Reference%253AStates_of_Operation.html#Publishing_Phase"><span class="tocnumber">2.3</span> <span class="toctext">Publishing Phase</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-6"><a href="Technical_Reference%253AStates_of_Operation.html#System_Initialization"><span class="tocnumber">3</span> <span class="toctext">System Initialization</span></a>
<ul>
<li class="toclevel-2 tocsection-7"><a href="Technical_Reference%253AStates_of_Operation.html#Information_Phase"><span class="tocnumber">3.1</span> <span class="toctext">Information Phase</span></a></li>
<li class="toclevel-2 tocsection-8"><a href="Technical_Reference%253AStates_of_Operation.html#Preflight_Phase"><span class="tocnumber">3.2</span> <span class="toctext">Preflight Phase</span></a></li>
<li class="toclevel-2 tocsection-9"><a href="Technical_Reference%253AStates_of_Operation.html#Initialization_Phase"><span class="tocnumber">3.3</span> <span class="toctext">Initialization Phase</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-10"><a href="Technical_Reference%253AStates_of_Operation.html#System_is_Suspended"><span class="tocnumber">4</span> <span class="toctext">System is Suspended</span></a></li>
<li class="toclevel-1 tocsection-11"><a href="Technical_Reference%253AStates_of_Operation.html#System_is_Running"><span class="tocnumber">5</span> <span class="toctext">System is Running</span></a></li>
<li class="toclevel-1 tocsection-12"><a href="Technical_Reference%253AStates_of_Operation.html#System_Termination"><span class="tocnumber">6</span> <span class="toctext">System Termination</span></a></li>
</ul>
</div>

<h3><span class="mw-headline" id="State_Diagram">State Diagram</span></h3>
<pre>Startup -&gt; Initialization &lt;-&gt; Suspended -&gt; Termination
                                  ^
                                  |
                                  v
                               Running
</pre>
<h2><span class="mw-headline" id="System_Startup">System Startup</span></h2>
<h3><span class="mw-headline" id="Introduction">Introduction</span></h3>
<p>Since the system is a distributed system of encapsulated modules, a proper and well defined information flow at start-up needs to be ensured.
Each module publishes its requests for parameters and states to
the Operator module, which configures those and sends them back.
Once the Signal Source module receives all parameters and states, it tries to
connect
to Signal Processing and, upon successful connection, sends a
positive status
message to the Operator.
In the same way, Signal Processing connects to the Application and the
Application module connects to the Signal Source module.
After the Operator receives status messages from all three core
modules, the
system is fully initialized and is triggered to start, as soon as the
Operator
sends the state <tt>Running</tt> with a value of 1 to the Signal Source module.
</p>
<h3><span class="mw-headline" id="Startup_Sequence">Startup Sequence</span></h3>
<p>The operator module must be started first. Its IP
address is provided to core modules when they are executed, defaulting to <i>localhost</i> to match the most typical configuration.
</p><p>The operator module listens on ports 4000
(for Source), 4001 (for Signal Processing), and 4002 (for Application),
and
waits for the respective core module to connect. Each can connect to
its
assigned port on the operator module in any order.
</p><p>Once connected to the operator module, each core
module opens its own listening socket on an arbitrary available port, and creates a parameter to contain this port number. Later on, these sockets will be used to create connections between core modules.
</p>
<h3><span class="mw-headline" id="Publishing_Phase">Publishing Phase</span></h3>
<p>Upon connection, each core module sends a <a href="Technical_Reference%253ABCI2000_Messages.html" title="Technical Reference:BCI2000 Messages">protocol version message</a> which is then matched with the operator module's protocol version, making sure that only modules with matching protocol versions are combined. 
</p><p>Following its protocol version, each core module publishes its parameters to the
operator module as a sequence of <a href="Technical_Reference%253ABCI2000_Messages.html" title="Technical Reference:BCI2000 Messages">parameter messages</a>.
After
publishing its
parameters, each core module publishes the states it requests as
a sequence of <a href="Technical_Reference%253ABCI2000_Messages.html" title="Technical Reference:BCI2000 Messages">state messages</a>.
Following the last
state, each core module sends a system command containing the string
<tt>EndOfState</tt>.
</p><p>On receiving this command from all core modules, the operator module
processes the received parameters and states. It
creates a
list of all parameters and all states, and creates a global state vector, ignoring all 
fields from state messages, except <i>Name</i>  and <i>Length</i>.
In order to maintain integrity throughout operation, no parameters or
states
should be added to or removed from the system beyond this point.
</p>
<h2><span class="mw-headline" id="System_Initialization">System Initialization</span></h2>
<h3><span class="mw-headline" id="Information_Phase">Information Phase</span></h3>
<p>At this point, the operator module
may modify
the value of the parameters and states (depending on the
investigator's manual input or loading a parameter file). 
The operator module then uses the same connections on
which it
received data from the core modules to send back to all core modules a
list of
system-wide parameters and system-wide states, in any order.
Since IP
addresses and port numbers on which the core modules listen for data from
other
core modules are represented in system parameters as described above, each
module now
knows where to connect to.
Accordingly, each core module opens a client
connection
to the core module it must connect to, i.e., Source opens a
connection to Signal Processing, Signal Processing to Application, and
Application to Source.
</p><p>The connections from core modules to
the
operator module remain open. All subsequent core-to-operator communication will go through
these
connections.
</p><p>As for the publishing phase, the Information Phase ends when a system
command
<tt>EndOfState</tt> is sent.
</p>
<h3><span class="mw-headline" id="Preflight_Phase">Preflight Phase</span></h3>
<p>In the preflight phase, each core module declares to the Operator module whether it is able to properly process data using current parameters and states.
In addition, it reports the properties of its output signal to the core module next in the chain.
</p><p>The Operator module opens the preflight phase by sending an empty <a href="Technical_Reference%253ABCI2000_Messages.html" title="Technical Reference:BCI2000 Messages">signal properties message</a> to the Source module.
The Source module then reports its output signal properties to the Signal Processing module by sending it an appropriate signal properties message.
The Signal Processing module, in turn, sends its output signal properties to the Application module.
</p><p>During the preflight phase, modules indicate errors by sending <a href="Technical_Reference%253ABCI2000_Messages.html" title="Technical Reference:BCI2000 Messages">status messages</a> containing plain-text error descriptions.
If any errors are found during the preflight phase, a module will not initiate its initialization phase. The operator module will display error messages received from core modules, prompting the user to fix the problems detected rather than offering a "Start" option.
</p>
<h3><span class="mw-headline" id="Initialization_Phase">Initialization Phase</span></h3>
<p>Each core module uses the information in the received parameters to
configure and
initialize its operation.
Then, each core module sends a <a href="Technical_Reference%253ABCI2000_Messages.html" title="Technical Reference:BCI2000 Messages">status message</a>
to the
operator that indicates either successful or failed initialization.
</p><p>The
Initialization Phase ends when all core modules indicate successful
configuration.
</p>
<h2><span class="mw-headline" id="System_is_Suspended">System is Suspended</span></h2>
<p>At the end of the Initialization Phase, the system is fully
configured. 
All parameters, states, and state vector, are now defined and available globally.
</p><p>The system's state is now determined by a special <i>Running</i> state variable, which is initially set to "0", indicating that the system is suspended.
</p><p>As long as operation is suspended, any module might update system parameters and send them back to the Operator.
Any module shall
disregard a
change in parameters unless the system is in suspended state.
</p><p>While the system is suspended, data may still flow
through the
system. 
It is up to each module to decide how to process these
data.
The Application, for example, might give visual feedback that indicates
that the system is suspended.
</p>
<h2><span class="mw-headline" id="System_is_Running">System is Running</span></h2>
<p>The system is started when the Operator module sets the special state variable
<i>Running</i> 
to 1 and sends it to the Source module.
</p><p>During system operation, the Operator module may modify any state variable by sending
state messages to the Source module.
The Operator module must send states only to
the Source
module; Signal Processing and Application must disregard any state
that the
Operator does send to them.
</p>
<h2><span class="mw-headline" id="System_Termination">System Termination</span></h2>
<p>To each of the three core modules, the operator module indicates
regular system termination
by closing the connection to that module.
</p><p>Irregular system termination takes place when a core module loses connection to any of the two other core modules it
is connected
to.
In this case, it will send an error message to the operator, and then quit.
The operator module, in turn, will close connections to the
remaining core
modules.
</p>
<!-- 
NewPP limit report
Cached time: 20230524000346
Cache expiry: 86400
Dynamic content: false
Complications: []
CPU time usage: 0.015 seconds
Real time usage: 0.018 seconds
Preprocessor visited node count: 43/1000000
Post‐expand include size: 0/2097152 bytes
Template argument size: 0/2097152 bytes
Highest expansion depth: 2/40
Expensive parser function count: 0/100
Unstrip recursion depth: 0/20
Unstrip post‐expand size: 0/5000000 bytes
-->
<!--
Transclusion expansion time report (%,ms,calls,template)
100.00%    0.000      1 -total
-->

<!-- Saved in parser cache with key wikidb-bci_:pcache:idhash:1435-0!canonical and timestamp 20230524000346 and revision id 4582
 -->
</div></div><div class="printfooter">
Retrieved from "<a dir="ltr" href="http://www.bci2000.org/mediawiki/index.php?title=Technical_Reference:States_of_Operation&amp;oldid=4582">http://www.bci2000.org/mediawiki/index.php?title=Technical_Reference:States_of_Operation&amp;oldid=4582</a>"</div>
 </div>
</body>
</html>