<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8"/>
<title>Contributions:EyetrackerLoggerTobiiX - BCI2000 Help</title>
<link rel='shortcut icon' href='../../rsrc/favicon.ico' />
<style type='text/css'>
html { font-size:95%; font-family:arial,helvetica,sans-serif }
.printfooter { display:none }
#tocmain { font-size:81%; font-weight:bold; color:black; background-color:white; border:1px solid black; padding:1em; z-index:10; position:fixed; left:-1px; top:-1px; width:150px; }
#tocmain a { color:blue; text-decoration:none }
#tocmain ul { margin:0 0 0 0.4em; padding:0.1em 0 0 0.1em; list-style-position:outside; list-style-type:disc }
#tocmain li { text-indent:0; margin:0 0 0 1em; padding: 0 0 0 0 }
#tocmain p { margin:0; padding:0.1em 0 0 0.1em }
#tocmain .toc1 { margin-left:1.25em; }
#tocmain .toc2 { margin-left:2.25em; }
#tocmain .toc3 { margin-left:3.25em; }
#article { font-size:91%; position:absolute; left:200px; right:0; padding:1em; margin:0 }
</style>
</head>
<body>
 <div id='tocmain'>
 <a href='Main_Page.html'><img src='../../rsrc/bci2000logo.svg' alt='[Main Page]' /></a> <hr class="sep" /><p class="toc0"><a href="User_Tutorial%253ABCI2000_Tour.html">GettingStarted</a></p><ul></ul><p class="toc0"><a href="User_Reference%253AContents.html">User Manual</a></p><ul></ul><p class="toc0"><a href="Technical_Reference%253AContents.html">Technical Reference</a></p><ul></ul><p class="toc0"><a href="Programming_Reference%253AContents.html">Programming Manual</a></p><ul></ul><p class="toc0"><a href="Contributions%253AContents.html">Contributions</a></p><ul><li class="toc1"><a href="Contributions%253AADCs.html">Data Acquisition</a></li><li class="toc1"><a href="Contributions%253AFileWriters.html">File Formats</a></li><li class="toc1"><a href="Contributions%253ASignalProcessing.html">Signal Processing</a></li><li class="toc1"><a href="Contributions%253AApplications.html">Applications</a></li><li class="toc1"><a href="Contributions%253ATools.html">Tools</a></li></ul><hr class="sep" /><p class="toc0"><a href="BCI2000_Glossary.html">BCI2000 Glossary</a></p> </div>
 <div id='article'>
 <h1 class = "pagetitle">EyetrackerLoggerTobiiX</h1>
 <p class = "subtitle">Contributions</p>
 <hr class = "sep" />
 <div id="mw-content-text" lang="en" dir="ltr" class="mw-content-ltr"><div class="mw-parser-output"><div id="toc" class="toc" role="navigation" aria-labelledby="mw-toc-heading"><input type="checkbox" role="button" id="toctogglecheckbox" class="toctogglecheckbox" style="display:none" /><div class="toctitle" lang="en" dir="ltr"><h2 id="mw-toc-heading">Contents</h2><span class="toctogglespan"><label class="toctogglelabel" for="toctogglecheckbox"></label></span></div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="Contributions%253AEyetrackerLoggerTobiiX.html#Synopsis"><span class="tocnumber">1</span> <span class="toctext">Synopsis</span></a></li>
<li class="toclevel-1 tocsection-2"><a href="Contributions%253AEyetrackerLoggerTobiiX.html#Location"><span class="tocnumber">2</span> <span class="toctext">Location</span></a></li>
<li class="toclevel-1 tocsection-3"><a href="Contributions%253AEyetrackerLoggerTobiiX.html#Versioning"><span class="tocnumber">3</span> <span class="toctext">Versioning</span></a>
<ul>
<li class="toclevel-2 tocsection-4"><a href="Contributions%253AEyetrackerLoggerTobiiX.html#Authors"><span class="tocnumber">3.1</span> <span class="toctext">Authors</span></a></li>
<li class="toclevel-2 tocsection-5"><a href="Contributions%253AEyetrackerLoggerTobiiX.html#Version_History"><span class="tocnumber">3.2</span> <span class="toctext">Version History</span></a></li>
<li class="toclevel-2 tocsection-6"><a href="Contributions%253AEyetrackerLoggerTobiiX.html#Source_Code_Revisions"><span class="tocnumber">3.3</span> <span class="toctext">Source Code Revisions</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-7"><a href="Contributions%253AEyetrackerLoggerTobiiX.html#Functional_Description"><span class="tocnumber">4</span> <span class="toctext">Functional Description</span></a></li>
<li class="toclevel-1 tocsection-8"><a href="Contributions%253AEyetrackerLoggerTobiiX.html#Integration_into_BCI2000"><span class="tocnumber">5</span> <span class="toctext">Integration into BCI2000</span></a></li>
<li class="toclevel-1 tocsection-9"><a href="Contributions%253AEyetrackerLoggerTobiiX.html#Usage_and_Calibration"><span class="tocnumber">6</span> <span class="toctext">Usage and Calibration</span></a></li>
<li class="toclevel-1 tocsection-10"><a href="Contributions%253AEyetrackerLoggerTobiiX.html#Parameters"><span class="tocnumber">7</span> <span class="toctext">Parameters</span></a></li>
<li class="toclevel-1 tocsection-11"><a href="Contributions%253AEyetrackerLoggerTobiiX.html#State_Variables"><span class="tocnumber">8</span> <span class="toctext">State Variables</span></a>
<ul>
<li class="toclevel-2 tocsection-12"><a href="Contributions%253AEyetrackerLoggerTobiiX.html#GazeX.2C_GazeY"><span class="tocnumber">8.1</span> <span class="toctext">GazeX, GazeY</span></a></li>
<li class="toclevel-2 tocsection-13"><a href="Contributions%253AEyetrackerLoggerTobiiX.html#EyetrackerStatesOK"><span class="tocnumber">8.2</span> <span class="toctext">EyetrackerStatesOK</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-14"><a href="Contributions%253AEyetrackerLoggerTobiiX.html#See_also"><span class="tocnumber">9</span> <span class="toctext">See also</span></a></li>
</ul>
</div>

<h2><span class="mw-headline" id="Synopsis">Synopsis</span></h2>
<p>A filter that records state information from <i>Tobii Eyetrackers Eye X</i> into state variables.
</p>
<h2><span class="mw-headline" id="Location">Location</span></h2>
<p><a rel="nofollow" class="external free" href="http://www.bci2000.org/svn/trunk/src/contrib/Extensions/EyetrackerLoggerTobiiX">http://www.bci2000.org/svn/trunk/src/contrib/Extensions/EyetrackerLoggerTobiiX</a>
</p>
<h2><span class="mw-headline" id="Versioning">Versioning</span></h2>
<h3><span class="mw-headline" id="Authors">Authors</span></h3>
<p>Kristopher Kaleb Goering (kaleb.goering@gmail.com)
</p>
<h3><span class="mw-headline" id="Version_History">Version History</span></h3>
<dl><dd>Initial public release;</dd></dl>
<p>2015/07/01 
</p>
<h3><span class="mw-headline" id="Source_Code_Revisions">Source Code Revisions</span></h3>
<ul><li>Initial development: 4880</li>
<li>Tested under: 4880</li>
<li>Known to compile under: 4880</li>
<li>Broken since: --</li></ul>
<h2><span class="mw-headline" id="Functional_Description">Functional Description</span></h2>
<p>In many cases, an experiment may require data about where the participant is looking.  In these experiments, an eyetracker is the only way to gather data relating to gaze position and eye location.  There are many eyetracking methods currently on the market, but many of these require the subject to hold their head steady -- often while strapped to a structure of some sort.  The Tobii eyetrackers require no such restriction so they were a natural choice when it came to interfacing with BCI2000.
</p>
<h2><span class="mw-headline" id="Integration_into_BCI2000">Integration into BCI2000</span></h2>
<p>Compile the extension into your source module by enabling contributed extensions in your CMake configuration.  You can do this by going into your root build folder and deleting <code>CMakeCache.txt</code> and re-running the project batch file, or by running <code>cmake -i</code> and enabling <b>BUILD_EYETRACKERLOGGERTOBIIX</b>.  Once the extension is built into the source module, enable it by starting the source module with the <code>--LogEyetrackerTobiiX=1</code> command line argument.
</p>
<h2><span class="mw-headline" id="Usage_and_Calibration">Usage and Calibration</span></h2>
<p>Set up the eyetracker as detailed in the documentation that came with your device.  The device will connect to your machine and communicate through the ethernet port.  As such, it'd be wise to disconnect and turn off any other networking devices while using the eyetracker.  It is possible that your network request could go out over a different network interface if you're not careful which makes for a troubleshooting nightmare.  When you start the source module, ensure that the <code>--LogEyetrackerTobiiX=1</code> command line parameter is set.  Run the Eyetracker Browser utility which came with your eyetracker drivers and use it to locate the device on your local network. 
</p><p>Calibration can now occur.  Calibration should be done per subject per sitting.  Re-calibration is not necessary between runs, but any time that the subject changes eyewear, makeup, or position, or if the lighting conditions change it should be re-calibrated. A good rule of thumb would be to recalibrate at the start of every session.  Once a calibration is performed, it is saved in the Tobii device until the next calibration (even if there's a power loss).
</p><p>BCI2000 does not provide any way to calibrate the eyetracker. Upon connecting the eyetracker to the computer via USB port, it should ask for calibrations. <b>Note</b> - the Tobii Eyetracker Eye X requires SS USB 3.0 port to communicate through. It cannot use USB 2.0 ports.
</p><p>Once the device is calibrated, it can be used reliably in BCI2000.  The logger will report information about eye validity in a text visualization window and feed states into the system.
</p>
<h2><span class="mw-headline" id="Parameters">Parameters</span></h2>
<p>The eyetracker is configured in the Source tab within the EyetrackerLogger section.  The configurable parameters are:
</p>
<ul><li><code>LogEyetrackerTobiiX</code>   - Enables/Disables logging of Eyetracker states</li>
<li><code>LogGazeData</code> - Enables/Disables logging of gaze data</li>
<li><code>LogEyePos</code> - Enables/Disables logging of eye position (as seen from the camera)</li>
<li><code>LogPupilSize</code> - Enables/Disables logging of pupil size (very rough)</li>
<li><code>LogEyeDist</code> - Enables/Disables logging of the distance from the screen to the eyes (again, rough)</li>
<li><code>GazeScale</code> - Scales the incoming gaze data first</li>
<li><code>GazeOffset</code> - Offsets the incoming gaze data after scaling</li></ul>
<p>Note: GazeScale and GazeOffset are quick hacks to address an issue with gaze data being clamped around the edges of the screen.  The eyetracker gives back values which are between 0.0 and 1.0 for onscreen gaze but supports looking slightly offscreen by allowing gaze data returned to go above 1.0 and below 0.0.  BCI2000 needs this scaled between 0.0 and 1.0 before the gaze data is multiplied by 65535 for storage in the 16 bit state.  These two parameters account for this scaling and offset and prevents the clamping from happening as often as it would otherwise.  These parameters will be removed once BCI2000 supports typed states. Brought from EyetrackerLogger
</p><p>The following code retreives the actual ~(0.0-1.0) range that the eyetracker outputs directly (assuming you've scaled and offset the signal to avoid clipping) from each eye and averages it to find a gaze position.
</p>
<pre>float x = State( "EyetrackerLeftEyeGazeX" ) + State( "EyetrackerRightEyeGazeX" ); x /= ( 2.0f * 65535.0f );
float y = State( "EyetrackerLeftEyeGazeY" ) + State( "EyetrackerRightEyeGazeY" ); y /= ( 2.0f * 65535.0f );
x -= ( float )Parameter( "GazeOffset" ); x /= ( float )Parameter( "GazeScale" );
y -= ( float )Parameter( "GazeOffset" ); y /= ( float )Parameter( "GazeScale" );
</pre>
<h2><span class="mw-headline" id="State_Variables">State Variables</span></h2>
<p>Unless otherwise specified, all states are prefixed with <code>Eyetracker&lt;Left/Right&gt;Eye</code> which corresponds with each individual eye.  The EyetrackerLogger extension does not support subjects with more than two eyes at the moment.
</p>
<h3><span id="GazeX,_GazeY"></span><span class="mw-headline" id="GazeX.2C_GazeY">GazeX, GazeY</span></h3>
<p>The eye gaze position (where - on the screen - the subject is looking) is returned from the Tobii SDK as 32 bit floating point numbers which (roughly) range from 0.0 to 1.0.  They are multiplied by 65535 and stored as 16 bit integers in these states if the <code>LogGazeData</code> parameter is enabled.  (0,0) corresponds to the top left of the screen, (65535,65535) corresponds to the right bottom of the screen. -- See <a href="Contributions%253AEyetrackerLogger.html#EyetrackerStatesOK" title="Contributions:EyetrackerLogger">EyetrackerStatesOK</a>.
</p>
<h3><span class="mw-headline" id="EyetrackerStatesOK">EyetrackerStatesOK</span></h3>
<p>Early versions of the extension didn't take into account that the library may return a number greater than 1.0 or less than 0.0.  This resulted in "pac-man" style wrap around of gaze coordinates in 2.0 and crashes in 3.0.  If the output from the library is out of bounds, it is clamped to the boundaries and the "EyetrackerStatesOK" parameter is changed.  A value of "1" corresponds to valid gaze data, a value of "0" corresponds to invalid "clamped" gaze data. Those parameters scale and offset the data so that when it does go out of range, it can still be fit into the 16 bit state.
</p>
<h2><span class="mw-headline" id="See_also">See also</span></h2>
<p><a href="User_Reference%253ALogging_Input.html" title="User Reference:Logging Input">User Reference:Logging Input</a>, <a href="Contributions%253AExtensions.html" title="Contributions:Extensions">Contributions:Extensions</a>, <a href="Contributions%253AEyetrackerLogger.html" title="Contributions:EyetrackerLogger">Contributions:EyetrackerLogger</a>
</p>
<!-- 
NewPP limit report
Cached time: 20230524175455
Cache expiry: 86400
Dynamic content: false
Complications: []
CPU time usage: 0.016 seconds
Real time usage: 0.019 seconds
Preprocessor visited node count: 50/1000000
Post‐expand include size: 15/2097152 bytes
Template argument size: 0/2097152 bytes
Highest expansion depth: 2/40
Expensive parser function count: 0/100
Unstrip recursion depth: 0/20
Unstrip post‐expand size: 390/5000000 bytes
-->
<!--
Transclusion expansion time report (%,ms,calls,template)
100.00%    0.000      1 -total
-->

<!-- Saved in parser cache with key wikidb-bci_:pcache:idhash:2091-0!canonical and timestamp 20230524175455 and revision id 7564
 -->
</div></div><div class="printfooter">
Retrieved from "<a dir="ltr" href="http://www.bci2000.org/mediawiki/index.php?title=Contributions:EyetrackerLoggerTobiiX&amp;oldid=7564">http://www.bci2000.org/mediawiki/index.php?title=Contributions:EyetrackerLoggerTobiiX&amp;oldid=7564</a>"</div>
 </div>
</body>
</html>