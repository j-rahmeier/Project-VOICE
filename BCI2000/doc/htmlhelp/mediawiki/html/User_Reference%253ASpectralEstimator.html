<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8"/>
<title>User Reference:SpectralEstimator - BCI2000 Help</title>
<link rel='shortcut icon' href='../../rsrc/favicon.ico' />
<style type='text/css'>
html { font-size:95%; font-family:arial,helvetica,sans-serif }
.printfooter { display:none }
#tocmain { font-size:81%; font-weight:bold; color:black; background-color:white; border:1px solid black; padding:1em; z-index:10; position:fixed; left:-1px; top:-1px; width:150px; }
#tocmain a { color:blue; text-decoration:none }
#tocmain ul { margin:0 0 0 0.4em; padding:0.1em 0 0 0.1em; list-style-position:outside; list-style-type:disc }
#tocmain li { text-indent:0; margin:0 0 0 1em; padding: 0 0 0 0 }
#tocmain p { margin:0; padding:0.1em 0 0 0.1em }
#tocmain .toc1 { margin-left:1.25em; }
#tocmain .toc2 { margin-left:2.25em; }
#tocmain .toc3 { margin-left:3.25em; }
#article { font-size:91%; position:absolute; left:200px; right:0; padding:1em; margin:0 }
</style>
</head>
<body>
 <div id='tocmain'>
 <a href='Main_Page.html'><img src='../../rsrc/bci2000logo.svg' alt='[Main Page]' /></a> <hr class="sep" /><p class="toc0"><a href="User_Tutorial%253ABCI2000_Tour.html">GettingStarted</a></p><ul></ul><p class="toc0"><a href="User_Reference%253AContents.html">User Manual</a></p><ul><li class="toc1"><a href="User_Reference%253AOperator_Module.html">Operator Module</a></li><li class="toc1"><a href="User_Reference%253AOperator_Module_Scripting.html">Operator Scripting</a></li><li class="toc1"><a href="User_Reference%253AModule_Command_Line_Options.html">Module Command Line Options</a></li><li class="toc1"><a href="User_Reference%253AData_File_Formats.html">Data File Formats</a></li><li class="toc1"><a href="User_Reference%253AFilters.html">Configuration Guide</a></li><li class="toc1"><a href="User_FAQ.html">FAQ</a></li><li class="toc1">Applications</li><ul><li class="toc2"><a href="User_Reference%253ACursorTask.html">Cursor Task</a></li><li class="toc2"><a href="User_Reference%253AP3SpellerTask.html">P3Speller Task</a></li><li class="toc2"><a href="https://www.bci2000.org/mediawiki/index.php/User_Reference:StimulusPresentation">Stimulus Presentation</a></li></ul><li class="toc1">Tools</li><ul><li class="toc2"><a href="User_Reference%253ABCI2000Certification.html">BCI2000Certification</a></li><li class="toc2"><a href="User_Reference%253ABCI2000Launcher.html">BCI2000Launcher</a></li><li class="toc2"><a href="User_Reference%253ABCI2000Viewer.html">BCI2000Viewer</a></li><li class="toc2"><a href="User_Reference%253ABCI2000FileInfo.html">BCI2000FileInfo</a></li><li class="toc2"><a href="User_Reference%253ABCI2000Export.html">BCI2000Export</a></li><li class="toc2"><a href="User_Reference%253ABCI2000Analysis.html">BCI2000Analysis</a></li><li class="toc2"><a href="User_Reference%253ABCI2000_Offline_Analysis.html">BCI2000 Offline Analysis</a></li><li class="toc2"><a href="User_Reference%253AEloc_Helper.html">Eloc Helper</a></li><li class="toc2"><a href="User_Reference%253AEEGLabImport.html">EEGLabImport</a></li><li class="toc2"><a href="User_Reference%253AMatlab_Tools.html">Matlab Tools</a></li><li class="toc2"><a href="User_Reference%253AMatlab_MEX_Files.html">Matlab MEX Files</a></li><li class="toc2"><a href="User_Reference%253ACommand_Line_Processing.html">Command Line Processing</a></li></ul></ul><p class="toc0"><a href="Technical_Reference%253AContents.html">Technical Reference</a></p><ul></ul><p class="toc0"><a href="Programming_Reference%253AContents.html">Programming Manual</a></p><ul></ul><p class="toc0"><a href="Contributions%253AContents.html">Contributions</a></p><ul></ul><hr class="sep" /><p class="toc0"><a href="BCI2000_Glossary.html">BCI2000 Glossary</a></p> </div>
 <div id='article'>
 <h1 class = "pagetitle">SpectralEstimator</h1>
 <p class = "subtitle">User Reference</p>
 <hr class = "sep" />
 <div id="mw-content-text" lang="en" dir="ltr" class="mw-content-ltr"><div class="mw-parser-output"><div id="toc" class="toc" role="navigation" aria-labelledby="mw-toc-heading"><input type="checkbox" role="button" id="toctogglecheckbox" class="toctogglecheckbox" style="display:none" /><div class="toctitle" lang="en" dir="ltr"><h2 id="mw-toc-heading">Contents</h2><span class="toctogglespan"><label class="toctogglelabel" for="toctogglecheckbox"></label></span></div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="User_Reference%253ASpectralEstimator.html#Function"><span class="tocnumber">1</span> <span class="toctext">Function</span></a>
<ul>
<li class="toclevel-2 tocsection-2"><a href="User_Reference%253ASpectralEstimator.html#AR_Algorithm"><span class="tocnumber">1.1</span> <span class="toctext">AR Algorithm</span></a></li>
<li class="toclevel-2 tocsection-3"><a href="User_Reference%253ASpectralEstimator.html#FFT_Algorithm"><span class="tocnumber">1.2</span> <span class="toctext">FFT Algorithm</span></a></li>
<li class="toclevel-2 tocsection-4"><a href="User_Reference%253ASpectralEstimator.html#Physical_unit_of_the_estimated_spectrum"><span class="tocnumber">1.3</span> <span class="toctext">Physical unit of the estimated spectrum</span></a></li>
<li class="toclevel-2 tocsection-5"><a href="User_Reference%253ASpectralEstimator.html#Normalization_of_the_estimated_spectrum"><span class="tocnumber">1.4</span> <span class="toctext">Normalization of the estimated spectrum</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-6"><a href="User_Reference%253ASpectralEstimator.html#Parameters"><span class="tocnumber">2</span> <span class="toctext">Parameters</span></a>
<ul>
<li class="toclevel-2 tocsection-7"><a href="User_Reference%253ASpectralEstimator.html#WindowLength"><span class="tocnumber">2.1</span> <span class="toctext">WindowLength</span></a></li>
<li class="toclevel-2 tocsection-8"><a href="User_Reference%253ASpectralEstimator.html#Detrend"><span class="tocnumber">2.2</span> <span class="toctext">Detrend</span></a></li>
<li class="toclevel-2 tocsection-9"><a href="User_Reference%253ASpectralEstimator.html#ModelOrder"><span class="tocnumber">2.3</span> <span class="toctext">ModelOrder</span></a></li>
<li class="toclevel-2 tocsection-10"><a href="User_Reference%253ASpectralEstimator.html#OutputType"><span class="tocnumber">2.4</span> <span class="toctext">OutputType</span></a></li>
<li class="toclevel-2 tocsection-11"><a href="User_Reference%253ASpectralEstimator.html#FirstBinCenter"><span class="tocnumber">2.5</span> <span class="toctext">FirstBinCenter</span></a></li>
<li class="toclevel-2 tocsection-12"><a href="User_Reference%253ASpectralEstimator.html#LastBinCenter"><span class="tocnumber">2.6</span> <span class="toctext">LastBinCenter</span></a></li>
<li class="toclevel-2 tocsection-13"><a href="User_Reference%253ASpectralEstimator.html#BinWidth"><span class="tocnumber">2.7</span> <span class="toctext">BinWidth</span></a></li>
<li class="toclevel-2 tocsection-14"><a href="User_Reference%253ASpectralEstimator.html#EvaluationsPerBin"><span class="tocnumber">2.8</span> <span class="toctext">EvaluationsPerBin</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-15"><a href="User_Reference%253ASpectralEstimator.html#States"><span class="tocnumber">3</span> <span class="toctext">States</span></a></li>
<li class="toclevel-1 tocsection-16"><a href="User_Reference%253ASpectralEstimator.html#Examples"><span class="tocnumber">4</span> <span class="toctext">Examples</span></a></li>
<li class="toclevel-1 tocsection-17"><a href="User_Reference%253ASpectralEstimator.html#See_also"><span class="tocnumber">5</span> <span class="toctext">See also</span></a></li>
</ul>
</div>

<h2><span class="mw-headline" id="Function">Function</span></h2>
<p>The SpectralEstimator computes a continually updated estimate of the spectrum of its input data, i.e. the distribution of amplitude or energy over frequencies.
Spectral estimation is done separately for each of the filter's input channels.
</p><p>For each block of data, it uses a past window of data. Optionally, detrending is applied to the data in this window. Also, multiplication with a side lobe suppression window function may be performed, which is routinely done when estimating a spectrum from windowed data.
</p><p>You may choose from two independent, and very different, spectral estimation algorithms, one based on <b>Autoregression</b> (AR), and one based on the <b>Fast Fourier Transform</b> (FFT).
</p>
<h3><span class="mw-headline" id="AR_Algorithm">AR Algorithm</span></h3>
<p>The AR algorithm computes an autoregressive model of its input data using the <a rel="nofollow" class="external text" href="http://en.wikipedia.org/wiki/Maximum_entropy_spectral_estimation">Maximum Entropy Method</a> (Burg method).
Its output may be raw AR coefficients, or an estimated power spectrum collected into bins.
</p><p>AR coefficients are actually the coefficients of an all-pole <a rel="nofollow" class="external text" href="http://en.wikipedia.org/wiki/Linear_filter">linear filter</a> that is fitted to reproduce the data's spectrum when applied to white noise.
</p><p>Thus, the estimated <i>power spectrum</i> directly corresponds to that filter's transfer function, divided by the signal's total power.
To obtain spectral power for finite-sized <i>frequency bins</i>, that <i>power spectrum</i> needs to be multiplied by total signal power, and integrated over the frequency ranges corresponding to individual bins.
</p><p>This is done by numerical integration, evaluating the spectrum at equally spaced evaluation points, summing, and multiplying by bin width to obtain the power corresponding to a certain bin.
For <i>amplitude</i> rather than <i>power spectrum</i> output, bin integrals are replaced with their square roots.
</p>
<h3><span class="mw-headline" id="FFT_Algorithm">FFT Algorithm</span></h3>
<p>The FFT algorithm computes the <a rel="nofollow" class="external text" href="http://en.wikipedia.org/wiki/Discrete_Fourier_Transform">Discrete Fourier Transform</a> of its input data, i.e. it transforms its input into a representation in the frequency domain rather than the time domain. This is a linear transform, which may be viewed as expanding the input data in a new set of basis vectors, which correspond to equally spaced negative and positive frequency bins. The expansion coefficient (or Fourier coefficient) corresponding to a frequency component is a complex number, whose magnitude may be interpreted to represent signal amplitude in the associated frequency bin, and whose phase corresponds to the phase of the signal in that frequency bin.
</p><p>In contrast to a naive DFT implementation, which requires time proportional to <img class="mwe-math-fallback-image-inline tex" alt="O(N^2)" src="../images/math/f/c/f/fcfcbd130c01389717669e8a2772703b.png" />, the FFT algorithm performs the computation in time proportional to <img class="mwe-math-fallback-image-inline tex" alt="O(N logN)" src="../images/math/7/d/e/7deeff9af96fe8fac40db184b1837f20.png" /> (with <img class="mwe-math-fallback-image-inline tex" alt="N" src="../images/math/8/d/9/8d9c307cb7f3c4a32822a51922d1ceaa.png" /> being the number of input samples, which must be powers of two in the original FFT algorithm). The SpectralEstimation filter uses a generalization of the FFT algorithm, called <a rel="nofollow" class="external text" href="http://www.fftw.org">FFTW</a>, that can efficiently handle any number of input samples.
</p>
<h3><span class="mw-headline" id="Physical_unit_of_the_estimated_spectrum">Physical unit of the estimated spectrum</span></h3>
<p>A power spectrum is an energy density distribution over frequencies. Thus, its physical dimension is "energy per frequency". The ARFilter actually computes a time series of such spectra, representing a flow of energy through each single point in the frequency domain. The proper physical dimension of such a flow is "energy per frequency per time".
</p><p>In BCI2000, signal amplitude is measured in <img class="mwe-math-fallback-image-inline tex" alt="\mu V" src="../images/math/a/0/c/a0c8c64b8931b67b0ceb94b284b27e20.png" />, so signal energy is measured in <img class="mwe-math-fallback-image-inline tex" alt="(\mu V)^2" src="../images/math/c/b/e/cbe4c08e13f6fd267ca0a93bcc700ae7.png" />. Measuring frequency in Hz, and time in seconds, these will cancel out in the physical unit's denominator. Thus, the physical unit of a power spectrum is <img class="mwe-math-fallback-image-inline tex" alt="(\mu V)^2" src="../images/math/c/b/e/cbe4c08e13f6fd267ca0a93bcc700ae7.png" />, and <img class="mwe-math-fallback-image-inline tex" alt="\mu V" src="../images/math/a/0/c/a0c8c64b8931b67b0ceb94b284b27e20.png" /> for an amplitude spectrum.
</p>
<h3><span class="mw-headline" id="Normalization_of_the_estimated_spectrum">Normalization of the estimated spectrum</span></h3>
<p>Normalization is applied to energy, and chosen such that input energy per second matches output energy, summed over all bins. For an input signal <img class="mwe-math-fallback-image-inline tex" alt="s_t" src="../images/math/a/3/a/a3a3f952fba5fcdece66112dac7008ad.png" /> and an output spectrum <img class="mwe-math-fallback-image-inline tex" alt="f_\omega" src="../images/math/1/c/5/1c5536062ef8fbe28a45aa74525df5a8.png" />, this means
</p><p><img class="mwe-math-fallback-image-inline tex" alt="\frac{\sum_{t = t_0..t_N}s_t^2}{t_N - t_0} = \sum_{\omega}|f_\omega|^2." src="../images/math/d/a/2/da25dc1e6a9fe13757d6e6a5418462ff.png" />
</p><p>Normalization is applied for both AR and FFT algorithms in this way.
</p>
<h2><span class="mw-headline" id="Parameters">Parameters</span></h2>
<p>For all frequency-valued parameters, raw float values are interpreted in terms of the sampling rate; absolute frequencies may be given when followed with <i>Hz</i>, as in the following examples:
</p>
<ul><li><i>0.5</i> will always refer to the Nyquist frequency (half the sampling rate).</li>
<li><i>10.3Hz</i> specifies a value of 10.3 Hz, regardless of the sampling rate.</li>
<li><i>15/2Hz</i> specifies a value of 7.5 Hz.</li>
<li>The unit must immediately follow the number.</li></ul>
<h3><span class="mw-headline" id="WindowLength">WindowLength</span></h3>
<p>The length of the input data window over which the model/spectrum is computed, given as a time value in seconds (then immediately followed by the unit), or the number of signal blocks as in the following examples:
</p>
<pre>1.34s
500ms
5
</pre>
<p>In case of the FFT algorithm, the <tt>WindowLength</tt> parameter does not determine the number of input samples in the FFT (FFT size); rather, FFT size is determined by the <tt>BinWidth</tt> parameter.
</p>
<h3><span class="mw-headline" id="Detrend">Detrend</span></h3>
<p>Determines whether data are detrended prior to spectral estimation. Possible values are
</p>
<ul><li>0: no detrending,</li>
<li>1: mean removal,</li>
<li>2: linear trend removal.</li></ul>
<h3><span class="mw-headline" id="ModelOrder">ModelOrder</span></h3>
<p>The order of the autoregressive model. Roughly, this corresponds to the maximum number of peaks in the resulting spectrum. When using the FFT-based algorithm, this parameter is not used.
</p>
<h3><span class="mw-headline" id="OutputType">OutputType</span></h3>
<p>Possible values are
</p>
<ul><li>0: spectral amplitude,</li>
<li>1: spectral power,</li>
<li>2: AR coefficients.</li></ul>
<p>If the output is a spectrum, the output signal's elements correspond to uniformly spaced frequency bins. For raw AR coefficients, the first output signal element contains total signal power, followed by the model's denominator coefficients.
</p>
<h3><span class="mw-headline" id="FirstBinCenter">FirstBinCenter</span></h3>
<p>A float value representing the center of the first frequency bin, e.g. "5Hz".
</p><p>In case of the AR algorithm, this is the first point where the estimated spectral function is evaluated. In case of the FFT algorithm, the input signal's DC component is shifted to the <tt>FirstBinCenter</tt> frequency by modulating with a complex carrier signal of a frequency <img class="mwe-math-fallback-image-inline tex" alt="\omega = 2 \pi \texttt{FirstBinCenter}" src="../images/math/9/b/d/9bd6cfab64790c2a1e72fb3396f5c373.png" />.
</p>
<h3><span class="mw-headline" id="LastBinCenter">LastBinCenter</span></h3>
<p>A float value representing the center of the last frequency bin. 
</p><p>If <tt>LastBinCenter</tt> - <tt>FirstBinCenter</tt> is not an integer multiple of <tt>BinWidth</tt>, <tt>LastBinCenter</tt> is rounded downward towards the closest integer multiple of <tt>BinWidth</tt>.
</p>
<h3><span class="mw-headline" id="BinWidth">BinWidth</span></h3>
<p>A single nonnegative float value representing the width of a single bin, e.g. "3Hz". For the AR algorithm, this is the distance between points where the spectrum is evaluated. For the FFT algorithm, this determines the number of points over which the FFT is calculated (FFT size). If the <tt>WindowSize</tt> parameter is less than FFT size, the FFT's input is padded with zeros. If <tt>WindowSize</tt> is greater than FFT size, multiple FFTs are computed, and their results summed up, until all input data has been used.
</p>
<h3><span class="mw-headline" id="EvaluationsPerBin">EvaluationsPerBin</span></h3>
<p>For the AR algorithm, this is a single nonnegative integer value representing the number of uniformly spaced evaluation points that enter into a single bin's value. For the FFT algorithm, this value is ignored.
</p>
<h2><span class="mw-headline" id="States">States</span></h2>
<p>None.
</p>
<h2><span class="mw-headline" id="Examples">Examples</span></h2>
<p>For a typical EEG application, you might use the following configuration:
</p>
<pre>ModelOrder= 16
FirstBinCenter= 0Hz
LastBinCenter= 30Hz
BinWidth= 3Hz
EvaluationsPerBin= 15
</pre>
<p>This will result in 11 bins, with the first bin covering the DC range from -1.5 to 1.5 Hz, which, due to symmetry of the transfer function, is twice the integral from 0 to 1.5 Hz. The last bin will cover the range from 28.5 Hz to 31.5 Hz. Evaluation points will be 0.2 Hz apart.
</p>
<h2><span class="mw-headline" id="See_also">See also</span></h2>
<p><a href="User_Reference%253AFFTFilter.html" title="User Reference:FFTFilter">FFTFilter</a>, <a href="User_Reference%253AMatlab_MEX_Files.html#mem" title="User Reference:Matlab MEX Files">User Reference:Matlab MEX Files#mem</a>
</p>
<!-- 
NewPP limit report
Cached time: 20220610011453
Cache expiry: 86400
Dynamic content: false
Complications: []
CPU time usage: 0.027 seconds
Real time usage: 0.031 seconds
Preprocessor visited node count: 105/1000000
Post‐expand include size: 0/2097152 bytes
Template argument size: 0/2097152 bytes
Highest expansion depth: 2/40
Expensive parser function count: 0/100
Unstrip recursion depth: 0/20
Unstrip post‐expand size: 1583/5000000 bytes
-->
<!--
Transclusion expansion time report (%,ms,calls,template)
100.00%    0.000      1 -total
-->

<!-- Saved in parser cache with key wikidb-bci_:pcache:idhash:1480-0!canonical!math=0 and timestamp 20220610011453 and revision id 8074
 -->
</div></div><div class="printfooter">
Retrieved from "<a dir="ltr" href="http://www.bci2000.org/mediawiki/index.php?title=User_Reference:SpectralEstimator&amp;oldid=8074">http://www.bci2000.org/mediawiki/index.php?title=User_Reference:SpectralEstimator&amp;oldid=8074</a>"</div>
 </div>
</body>
</html>