<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8"/>
<title>Programming Reference:Events - BCI2000 Help</title>
<link rel='shortcut icon' href='../../rsrc/favicon.ico' />
<style type='text/css'>
html { font-size:95%; font-family:arial,helvetica,sans-serif }
.printfooter { display:none }
#tocmain { font-size:81%; font-weight:bold; color:black; background-color:white; border:1px solid black; padding:1em; z-index:10; position:fixed; left:-1px; top:-1px; width:150px; }
#tocmain a { color:blue; text-decoration:none }
#tocmain ul { margin:0 0 0 0.4em; padding:0.1em 0 0 0.1em; list-style-position:outside; list-style-type:disc }
#tocmain li { text-indent:0; margin:0 0 0 1em; padding: 0 0 0 0 }
#tocmain p { margin:0; padding:0.1em 0 0 0.1em }
#tocmain .toc1 { margin-left:1.25em; }
#tocmain .toc2 { margin-left:2.25em; }
#tocmain .toc3 { margin-left:3.25em; }
#article { font-size:91%; position:absolute; left:200px; right:0; padding:1em; margin:0 }
</style>
</head>
<body>
 <div id='tocmain'>
 <a href='Main_Page.html'><img src='../../rsrc/bci2000logo.svg' alt='[Main Page]' /></a> <hr class="sep" /><p class="toc0"><a href="User_Tutorial%253ABCI2000_Tour.html">GettingStarted</a></p><ul></ul><p class="toc0"><a href="User_Reference%253AContents.html">User Manual</a></p><ul></ul><p class="toc0"><a href="Technical_Reference%253AContents.html">Technical Reference</a></p><ul></ul><p class="toc0"><a href="Programming_Reference%253AContents.html">Programming Manual</a></p><ul><li class="toc1">Concepts</li><ul><li class="toc2"><a href="Programming_Reference%253AFilter_Chain.html">Filter Chain</a></li><li class="toc2"><a href="Programming_Reference%253ASignals.html">Signals</a></li><li class="toc2"><a href="Programming_Reference%253AError_Handling.html">Error Handling</a></li><li class="toc2"><a href="Programming_Reference%253ALocalization.html">Localization</a></li><li class="toc2"><a href="Programming_Reference%253ARapid_Development.html">Rapid Development</a></li></ul><li class="toc1">Reference</li><ul><li class="toc2"><a href="Programming_Reference%253AGenericFilter_Class.html">GenericFilter</a></li><li class="toc2"><a href="Programming_Reference%253AEnvironment_Class.html">Environment</a></li><li class="toc2"><a href="Programming_Reference%253AGenericVisualization_Class.html">GenericVisualization</a></li><li class="toc2"><a href="Programming_Reference%253AErrors_and_Warnings.html">Errors and Warnings</a></li><li class="toc2"><a href="Programming_Reference%253ADebug_Output.html">Debug Output</a></li></ul><li class="toc1">Data Acquisition</li><ul><li class="toc2"><a href="Programming_Reference%253AGenericADC_Class.html">GenericADC</a></li></ul><li class="toc1">Data Storage</li><ul><li class="toc2"><a href="Programming_Reference%253AGenericFileWriter_Class.html">GenericFileWriter</a></li><li class="toc2"><a href="Programming_Reference%253ABCI2000FileReader_Class.html">BCI2000FileReader</a></li></ul><li class="toc1">Signal Processing</li><ul><li class="toc2"><a href="Programming_Reference%253AIIRFilterBase_Class.html">IIR Filters</a></li></ul><li class="toc1">Application Modules</li><ul><li class="toc2"><a href="Programming_Reference%253AApplicationBase_Class.html">ApplicationBase</a></li><li class="toc2"><a href="Programming_Reference%253AFeedbackTask_Class.html">FeedbackTask</a></li><li class="toc2"><a href="Programming_Reference%253AStimulusTask_Class.html">StimulusTask</a></li><li class="toc2"><a href="Programming_Reference%253A3D_API.html">3D API</a></li></ul><li class="toc1">Howtos</li><ul><li class="toc2"><a href="Programming_Howto%253ABuilding_BCI2000.html">Building BCI2000</a></li><li class="toc2"><a href="Programming_Howto%253ASVN_Client_Setup.html">SVN Client Setup</a></li><li class="toc2"><a href="Programming_Howto%253AUsing_TortoiseSVN.html">Using TortoiseSVN</a></li></ul><li class="toc1"><a href="Programming_FAQ.html">FAQ</a></li><li class="toc1">Tutorials</li><ul><li class="toc2"><a href="Programming_Tutorial%253AImplementing_a_Data_Acquisition_Module.html">Data Acquisition</a></li><li class="toc2"><a href="Programming_Tutorial%253AImplementing_a_Signal_Processing_Filter.html">Signal Processing</a></li><li class="toc2"><a href="Programming_Tutorial%253AImplementing_a_Matlab-based_Filter.html">Matlab Signal Processing</a></li></ul></ul><p class="toc0"><a href="Contributions%253AContents.html">Contributions</a></p><ul></ul><hr class="sep" /><p class="toc0"><a href="BCI2000_Glossary.html">BCI2000 Glossary</a></p> </div>
 <div id='article'>
 <h1 class = "pagetitle">Events</h1>
 <p class = "subtitle">Programming Reference</p>
 <hr class = "sep" />
 <div id="mw-content-text" lang="en" dir="ltr" class="mw-content-ltr"><div class="mw-parser-output"><p>This page describes how to record asynchronous information ("events") along with brain signal data. This usage of the term "event" is unrelated to "events" as part of <a href="Programming_Reference%253AContents.html#Programming_Interface_Documentation" title="Programming Reference:Contents">BCI2000 API class interfaces</a>.
</p><p>As data are recorded by data acquisition hardware in chunks, BCI2000 processes them synchronously.
Still, recording information that is asynchronous to brain signal data acquisition may be of interest to an experimenter. Typically, mouse or keyboard input may be of interest to record in an experiment, and ideally should provide a temporal resolution that corresponds to the brain signal's sampling rate.
</p>
<div id="toc" class="toc" role="navigation" aria-labelledby="mw-toc-heading"><input type="checkbox" role="button" id="toctogglecheckbox" class="toctogglecheckbox" style="display:none" /><div class="toctitle" lang="en" dir="ltr"><h2 id="mw-toc-heading">Contents</h2><span class="toctogglespan"><label class="toctogglelabel" for="toctogglecheckbox"></label></span></div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="Programming_Reference%253AEvents.html#Concept"><span class="tocnumber">1</span> <span class="toctext">Concept</span></a></li>
<li class="toclevel-1 tocsection-2"><a href="Programming_Reference%253AEvents.html#Implementation"><span class="tocnumber">2</span> <span class="toctext">Implementation</span></a></li>
<li class="toclevel-1 tocsection-3"><a href="Programming_Reference%253AEvents.html#Limitations"><span class="tocnumber">3</span> <span class="toctext">Limitations</span></a></li>
<li class="toclevel-1 tocsection-4"><a href="Programming_Reference%253AEvents.html#Event_API"><span class="tocnumber">4</span> <span class="toctext">Event API</span></a></li>
<li class="toclevel-1 tocsection-5"><a href="Programming_Reference%253AEvents.html#Descriptor_Syntax"><span class="tocnumber">5</span> <span class="toctext">Descriptor Syntax</span></a></li>
<li class="toclevel-1 tocsection-6"><a href="Programming_Reference%253AEvents.html#Extended_Syntax"><span class="tocnumber">6</span> <span class="toctext">Extended Syntax</span></a></li>
<li class="toclevel-1 tocsection-7"><a href="Programming_Reference%253AEvents.html#Example"><span class="tocnumber">7</span> <span class="toctext">Example</span></a></li>
<li class="toclevel-1 tocsection-8"><a href="Programming_Reference%253AEvents.html#See_also"><span class="tocnumber">8</span> <span class="toctext">See also</span></a></li>
</ul>
</div>

<h2><span class="mw-headline" id="Concept">Concept</span></h2>
<p>In the BCI2000 programming API, asynchronous information may be represented as <i>Events</i>.
</p><p>Here, an <i>Event</i> is an object that 
</p>
<ul><li>consists of two elements: a string descriptor and a time stamp, and</li>
<li>is recorded in a data file together with brain signals.</li></ul>
<h2><span class="mw-headline" id="Implementation">Implementation</span></h2>
<p>In the current version of BCI2000, events are mapped to <a href="BCI2000_Glossary.html#State" title="BCI2000 Glossary">state variables</a>. By comparing an event's time stamp to data acquisition time stamps, it is possible to associate events with single samples, and to map an event to a change in a state variable's value.
</p><p>In order to make events available for writing, they must be first declared as in the following example:
</p>
<pre>BEGIN_EVENT_DEFINITIONS
  "MyEvent 10 0 0 0",
END_EVENT_DEFINITIONS
</pre>
<p>Here, an event's definition follows the rules applying to the definition of state variables: first, the name is given, then follow bit width and initial value. At the end, a pair of zeros needs to be added.
</p>
<h2><span class="mw-headline" id="Limitations">Limitations</span></h2>
<ul><li>Time stamps have millisecond resolution. Up to sampling rates of 1kHz, this is not a practical restriction though.</li>
<li>Apart from the 1kHz limit given by time stamp resolution, the upper limit of temporal resolution is determined by the amplifier's maximum sampling rate.</li>
<li>Association of event time stamps with sample positions cannot be more accurate than <a href="https://www.bci2000.org/mediawiki/index.php/User_Reference:Timing" title="User Reference:Timing">time stamps assigned to data blocks</a> by the data acquisition module. If data transmission latency between data acquisition hardware, and its associated jitter, are large compared to a single sample's duration, then event positions cannot be expected to be precise. Still, for data acquisition devices that are connected directly to the machine running the data acquisition module (i.e., not over a network connection), and for sampling rates below 1kHz, transmission latency and jitter may be expected to be below a sample's duration.</li>
<li>Event time stamps must refer to the same physical time base that is used to stamp acquired data packets. This limits the use of events to BCI2000 modules that run on the same machine as the data acquisition module. To ensure correct operation also in situations where processing modules are distributed across multiple machines in a network, the event API may be used only in data acquisition modules.</li>
<li>The <tt>bcievent</tt> asynchronous stream interface should only be called between "StartRun" and "StopRun".  Logging events with <tt>bcievent</tt> outside of a run could result in delayed state logging through the <tt>bcievent</tt> interface.</li></ul>
<h2><span class="mw-headline" id="Event_API">Event API</span></h2>
<p>When including the <tt>src/shared/accessors/BCIEvent.h</tt> header file into a source code file, a symbol <tt>bcievent</tt> will be available.
The <tt>bcievent</tt> symbol behaves like a <tt>std::ostream</tt>; writing to that stream creates an event, fills its descriptor with whatever has been written into the stream, and stamps the event with current time.
The <tt>bcievent</tt> symbol's <tt>ostream</tt> behavior makes it convenient to include numeric information into the event's string descriptor.
To allow for true asynchrony, BCI2000 events may be issued from any thread within a BCI2000 module, i.e. the <tt>bcievent</tt> interface is thread-safe.
</p>
<h2><span class="mw-headline" id="Descriptor_Syntax">Descriptor Syntax</span></h2>
<p>An event descriptor consists of a name, a value, and optionally a duration, with data fields being separated with white space:
</p>
<pre>&lt;name&gt; &lt;value&gt; [&lt;duration&gt;]
</pre>
<p>Currently, events are mapped to state variables, so the following restrictions apply:
</p>
<ul><li>The name field must match the name of an event kind state variable defined within BEGIN_EVENT_DEFINITIONS/END_EVENT_DEFINITIONS, and that state variable must exist in the system before it appears in an event.</li>
<li>The value field must specify an unsigned integer value that "fits into" the number of bits reserved for the corresponding state variable.</li>
<li>Currently, the duration must either be omitted, or 0. When mapping the event to a state variable, a duration of 0 means that the state variable is set to the specified value for a single sample only, and to zero for subsequent samples. A non-specified duration means that the state variable is changed, and keeps its value for subsequent samples.</li></ul>
<h2><span class="mw-headline" id="Extended_Syntax">Extended Syntax</span></h2>
<p>bcievent is actually a macro hiding the definition of an object of type BCIEvent. You may create such an object yourself, which is useful if you want to define the time stamp to use rather than have it taken automatically for you.
</p>
<pre>BCIEvent(PrecisionTime::Now()) &lt;&lt; "MyEvent " &lt;&lt; value;
</pre>
<p>will match the default behavior: The event is initialized with the current time stamp at creation.
</p>
<pre>BCIEvent(PrecisionTime::Now() + 5) &lt;&lt; "MyEvent " &lt;&lt; value;
</pre>
<p>will delay the event by 5ms. Be warned, however, that time stamps extending beyond the sample block currently digitized will not work properly, due to the way how events are aligned with data in time.
</p>
<h2><span class="mw-headline" id="Example">Example</span></h2>
<p>In this example, an event "MyEvent" will be created, its value field set to <tt>currentValue</tt>, and its duration field empty.
Please note that the name is followed with a space character separating name and value.
The event will be time stamped when it is created, and will be sent when it goes out of scope, or is flushed explicitly. Unless
there is time-consuming code between event creation, and the end of scope, there is no need to flush it explicitly.
</p>
<pre>#include "BCIEvent.h"
...
{
  int currentValue;
  ...
  bcievent &lt;&lt; "MyEvent " &lt;&lt; currentValue; // MyEvent is time stamped here
  bcievent &lt;&lt; "AnotherEvent " &lt;&lt; currentValue &lt;&lt; std::flush; // AnotherEvent is time stamped and sent here
  BCIEvent(PrecisionTime::Now()+5) &lt;&lt; "Event3 " &lt;&lt; currentValue; // Event3 is time stamped here with a delayed time stamp
  ...
} // MyEvent and Event3 are sent here
</pre>
<h2><span class="mw-headline" id="See_also">See also</span></h2>
<p><a href="Programming_Reference%253AEnvironment_Class.html" title="Programming Reference:Environment Class">Programming Reference:Environment Class</a>, <a href="Technical_Reference%253AState_Definition.html" title="Technical Reference:State Definition">Technical Reference:State Definition</a>, <a href="Programming_Tutorial%253AImplementing_an_Input_Logger.html" title="Programming Tutorial:Implementing an Input Logger">Programming Tutorial:Implementing an Input Logger</a>
</p><p>Events are used to implement keyboard, mouse, and joystick logging: <a href="User_Reference%253ALogging_Input.html" title="User Reference:Logging Input">User Reference:Logging Input</a>
</p>
<!-- 
NewPP limit report
Cached time: 20230524175544
Cache expiry: 86400
Dynamic content: false
Complications: []
CPU time usage: 0.015 seconds
Real time usage: 0.018 seconds
Preprocessor visited node count: 27/1000000
Post‐expand include size: 0/2097152 bytes
Template argument size: 0/2097152 bytes
Highest expansion depth: 2/40
Expensive parser function count: 0/100
Unstrip recursion depth: 0/20
Unstrip post‐expand size: 0/5000000 bytes
-->
<!--
Transclusion expansion time report (%,ms,calls,template)
100.00%    0.000      1 -total
-->

<!-- Saved in parser cache with key wikidb-bci_:pcache:idhash:1789-0!canonical and timestamp 20230524175544 and revision id 9874
 -->
</div></div><div class="printfooter">
Retrieved from "<a dir="ltr" href="http://www.bci2000.org/mediawiki/index.php?title=Programming_Reference:Events&amp;oldid=9874">http://www.bci2000.org/mediawiki/index.php?title=Programming_Reference:Events&amp;oldid=9874</a>"</div>
 </div>
</body>
</html>